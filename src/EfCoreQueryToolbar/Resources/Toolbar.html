<div id="toolbar">
    <div id="toolbar-header">
        <button id="collapse-btn">
            &#9660;
        </button>

        <button id="clear-btn">
            &#10006;
        </button>
        <span>Query Toolbar</span>
    </div>
    <div id="debug-info">
        <ul>
            <li class="query-item">
                <pre>SELECT * FROM users</pre>
            </li>
            <li class="query-item">
                <pre>INSERT INTO orders</pre>
            </li>
            <li class="query-item">
                <pre>SELECT * FROM users WHERE email = 'john@example.com';</pre>
            </li>
            <li class="query-item">
                <pre>INSERT INTO orders (order_id, user_id, product_name, quantity) VALUES ('101', 12345, 'Laptop', 1);</pre>
            </li>
            <li class="query-item">
                <pre>UPDATE customers SET address = 'New York' WHERE customer_id = 67890;</pre>
            </li>
            <li class="query-item">
                <pre>DELETE FROM products WHERE product_id = 23456;</pre>
            </li>
            <li class="query-item">
                <pre>SELECT order_id, user_id, SUM(quantity) as total_quantity
FROM orders
GROUP BY order_id, user_id;</pre>
            </li>

            <li class="query-item">
                <pre>SELECT p.product_name, c.category_name, p.price
FROM products p
JOIN categories c ON p.category_id = c.id
WHERE p.price > 100
ORDER BY p.price DESC;</pre>
            </li>
            <li class="query-item">
                <pre>INSERT INTO customers (first_name, last_name, email, phone)
VALUES ('Sarah', 'Johnson', 'sarah.j@email.com', '555-0123');</pre>
            </li>
            <li class="query-item">
                <pre>SELECT o.order_id, c.customer_name, 
       SUM(oi.quantity * p.price) as total_amount
FROM orders o
JOIN customers c ON o.customer_id = c.id 
JOIN order_items oi ON o.order_id = oi.order_id
JOIN products p ON oi.product_id = p.id
GROUP BY o.order_id, c.customer_name
HAVING total_amount > 1000;</pre>
            </li>
            <li class="query-item">
                <pre>UPDATE inventory
SET stock_level = stock_level - 5,
    last_updated = CURRENT_TIMESTAMP
WHERE product_id IN (
    SELECT product_id 
    FROM products 
    WHERE category = 'Electronics'
);</pre>
            </li>
        </ul>
    </div>
</div>


<style>
    #toolbar {

        /* Initial state */
        height: 40px;
        display: block;
        /* Box Model */
        bottom: 0;
        left: 0;
        position: fixed;
        width: 100%;

        /* Visual */
        background: #333;
        color: #fff;
        z-index: 9999;

        /* Typography */
        font-family: sans-serif;

        /* Animation */
        transition: width 0.3s ease, height 0.3s ease;

        #toolbar-header {
            /* Box Model */
            padding: 5px;

            /* Layout */
            align-items: center;
            display: flex;

            /* Interaction */
            cursor: pointer;
            font-weight: bold;
            span {
                margin-left: 10px;
            }
        }
    }

    #collapse-btn {
        /* Box Model */
        border: none;
        border-radius: 4px;
        padding: 5px;

        /* Visual */
        background: #555;
        color: #fff;

        /* Interaction */
        cursor: pointer;
    }

    #debug-info {
        /* Box Model */
        max-height: 500px;
        padding: 10px;

        /* Layout */
        display: none;
        overflow-y: auto;

        /* Visual */
        background: #444;
        scrollbar-width: thin;

        &::-webkit-scrollbar {
            width: 8px;
        }

        &::-webkit-scrollbar-thumb {
            background: #666;
            border-radius: 4px;
        }

        .query-item {
            padding: 1rem 0.5rem;
            font-size: large;
            &:hover {
                background: rgb(85, 57, 8);
                cursor: pointer;
            }
        }
    }

    #toolbar {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        background: #333;
        color: #fff;
        z-index: 9999;
        padding-bottom: 5px;
        font-family: sans-serif;
        transition: height 0.3s ease;

        #toolbar-header {
            
            display: flex;
            align-items: center;
            padding: 5px;
            cursor: pointer;

            span {
                margin-left: 10px;
            }

            &:hover {
                background: #666;
            }
        }
    }

    #collapse-btn,
    #clear-btn {
        background: #555;
        color: #fff;
        border: none;
        padding: 5px;
        margin: 0 5px;
        border-radius: 4px;
        cursor: pointer;
    }

    #clear-btn {

        &:hover {
            background: #666;
            outline: 1px solid white;
        }
    }

    #debug-info {
        display: none;
        padding: 10px;
        background: #444;
        overflow-y: auto;
        /* max-height: 180px; */
        scrollbar-width: thin;

        &::-webkit-scrollbar {
            width: 8px;
        }

        &::-webkit-scrollbar-thumb {
            background: #666;
            border-radius: 4px;
        }

        &::-webkit-scrollbar-track {
            background: #444;
        }

        ul {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        li {
            margin-bottom: 10px;
            padding: 8px;
            background: #555;
            border-radius: 4px;
        }

        pre {
            margin: 0;
            white-space: pre-wrap;
            font-family: monospace;
        }
    }


    #floating-btn {

        position: fixed;
        top: 20px;
        left: 20px;

        border-radius: 50%;
        border-width: 1.5px;
        padding: 15px;
        cursor: pointer;
        font-size: 20px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        /* background: #4CAF50; */
        color: white;
        transition: all 0.2s ease;

        &:hover {
            /* background-color: #45a049; */
            box-shadow: 0 6px 14px rgba(0, 0, 0, 0.25);
            transform: translateY(-2px);
        }

        &:active {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            transform: translateY(1px);
        }

        .floating-btn-icon {
            color: red;
        }
    }

    .query-meta {
        font-size: 0.8em;
        color: #aaa;
        margin-top: 5px;
    }

    .query-meta span {
        margin-right: 15px;
    }

    .error {
        color: #ff6b6b;
        padding: 10px;
        text-align: center;
    }
</style>

<!-- Floating Bug Icon Button -->
<button id="floating-btn">
    <div class="floating-btn-icon">&#128295; <!-- Wrench icon --></div>
</button>

<script>
    const EfCoreQueryToolbar = (() => {
        const toolbar = document.getElementById("toolbar");
        const header = document.getElementById("toolbar-header");
        const collapseBtn = document.getElementById("collapse-btn");
        const debugInfo = document.getElementById("debug-info");
        const floatingBtn = document.getElementById("floating-btn");
        const clearBtn = document.getElementById("clear-btn");
        const debugList = debugInfo.querySelector("ul");

        // Mock API response
        const mockQueryData = {
            queries: [
                {
                    id: 1,
                    sql: "SELECT * FROM users",
                    duration: "120ms"
                },
                {
                    id: 2,
                    sql: "INSERT INTO orders",
                    duration: "85ms"
                },
                {
                    id: 3,
                    sql: "SELECT * FROM users WHERE email = 'john@example.com';",
                    duration: "95ms"
                },
                {
                    id: 4,
                    sql: "INSERT INTO orders (order_id, user_id, product_name, quantity) VALUES ('101', 12345, 'Laptop', 1);",
                    duration: "110ms"
                },
                {
                    id: 5,
                    sql: "UPDATE customers SET address = 'New York' WHERE customer_id = 67890;",
                    duration: "75ms"
                },
                {
                    id: 6,
                    sql: "DELETE FROM products WHERE product_id = 23456;",
                    duration: "65ms"
                },
                {
                    id: 7,
                    sql: `SELECT order_id, user_id, SUM(quantity) as total_quantity
FROM orders
GROUP BY order_id, user_id;`,
                    duration: "180ms"
                },
                {
                    id: 8,
                    sql: `SELECT p.product_name, c.category_name, p.price
FROM products p
JOIN categories c ON p.category_id = c.id
WHERE p.price > 100
ORDER BY p.price DESC;`,
                    duration: "200ms"
                },
                {
                    id: 9,
                    sql: `INSERT INTO customers (first_name, last_name, email, phone)
VALUES ('Sarah', 'Johnson', 'sarah.j@email.com', '555-0123');`,
                    duration: "90ms"
                },
                {
                    id: 10,
                    sql: `SELECT o.order_id, c.customer_name, 
       SUM(oi.quantity * p.price) as total_amount
FROM orders o
JOIN customers c ON o.customer_id = c.id 
JOIN order_items oi ON o.order_id = oi.order_id
JOIN products p ON oi.product_id = p.id
GROUP BY o.order_id, c.customer_name
HAVING total_amount > 1000;`,
                    duration: "250ms"
                },
                {
                    id: 11,
                    sql: `UPDATE inventory
SET stock_level = stock_level - 5,
    last_updated = CURRENT_TIMESTAMP
WHERE product_id IN (
    SELECT product_id 
    FROM products 
    WHERE category = 'Electronics'
);`,
                    duration: "150ms"
                }
            ]
        };

        // Mock API call function
        const fetchQueryData = () => {
            return new Promise((resolve) => {
                // Simulate network delay
                setTimeout(() => {
                    resolve(mockQueryData);
                }, 100);
            });
        };

        // Render query items
        const renderQueries = (queries) => {
            debugList.innerHTML = queries.map(query => `
                <li class="query-item">
                    <pre>${query.sql}</pre>
                    <div class="query-meta">
                        <span class="duration">${query.duration}</span>
                    </div>
                </li>
            `).join('');
        };

        const clearDebugInfo = () => {
            debugList.innerHTML = '';
        };

        // Load queries when expanding
        const expand = async () => {
            toolbar.style.height = '400px';
            debugInfo.style.display = 'block';
            collapseBtn.innerHTML = '&#9650;';
            isCollapsed = false;

            // Fetch and render queries
            try {
                const data = await fetchQueryData();
                renderQueries(data.queries);
            } catch (error) {
                console.error('Error fetching queries:', error);
                debugList.innerHTML = '<li class="error">Error loading queries</li>';
            }
        };

        let isCollapsed = true;

        const collapse = () => {
            toolbar.style.height = '40px';
            debugInfo.style.display = 'none';
            collapseBtn.innerHTML = '&#9660;';
            isCollapsed = true;
        };

        const toggle = () => {
            isCollapsed ? expand() : collapse();
        };

        // Event listeners
        header.addEventListener("click", toggle); // Header click toggles toolbar
        // collapseBtn.addEventListener("click", toggle); // Collapse button toggles
        floatingBtn.addEventListener("click", toggle); // Floating button toggles

        return { expand, collapse, toggle };
    })();
</script>